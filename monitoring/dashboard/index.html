<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DHT Network Monitor</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
            padding: 20px;
        }
        .container { max-width: 1200px; margin: 0 auto; }
        .header { text-align: center; margin-bottom: 30px; }
        .header h1 { font-size: 2.5em; margin-bottom: 10px; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }
        .status-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .card { 
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .node-status { display: flex; align-items: center; margin: 10px 0; }
        .status-indicator { 
            width: 12px; height: 12px; border-radius: 50%; margin-right: 10px;
            animation: pulse 2s infinite;
        }
        .online { background: #10b981; }
        .offline { background: #ef4444; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .api-section { margin-top: 20px; }
        .api-button { 
            background: rgba(16, 185, 129, 0.2);
            border: 1px solid #10b981;
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            margin: 5px;
            transition: all 0.3s;
        }
        .api-button:hover { background: rgba(16, 185, 129, 0.4); }
        .response-area { 
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin-top: 10px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 200px;
            overflow-y: auto;
        }
        .links-section { margin-top: 30px; text-align: center; }
        .link-button {
            display: inline-block;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            text-decoration: none;
            padding: 12px 24px;
            border-radius: 25px;
            margin: 10px;
            transition: all 0.3s;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        .link-button:hover { 
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üåê DHT Network Monitor</h1>
            <p>–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–π —Ö–µ—à-—Ç–∞–±–ª–∏—Ü—ã –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏</p>
        </div>

        <div class="status-grid">
            <div class="card">
                <h3>üìä –°—Ç–∞—Ç—É—Å —É–∑–ª–æ–≤</h3>
                <div id="nodes-status">
                    <div class="node-status">
                        <div class="status-indicator offline" id="status-8080"></div>
                        <span>Bootstrap —É–∑–µ–ª (8080)</span>
                    </div>
                    <div class="node-status">
                        <div class="status-indicator offline" id="status-8081"></div>
                        <span>DHT —É–∑–µ–ª 2 (8081)</span>
                    </div>
                    <div class="node-status">
                        <div class="status-indicator offline" id="status-8082"></div>
                        <span>DHT —É–∑–µ–ª 3 (8082)</span>
                    </div>
                    <div class="node-status">
                        <div class="status-indicator offline" id="status-8083"></div>
                        <span>DHT —É–∑–µ–ª 4 (8083)</span>
                    </div>
                    <div class="node-status">
                        <div class="status-indicator offline" id="status-8084"></div>
                        <span>DHT —É–∑–µ–ª 5 (8084)</span>
                    </div>
                    <div class="node-status">
                        <div class="status-indicator offline" id="status-8085"></div>
                        <span>DHT —É–∑–µ–ª 6 (8085)</span>
                    </div>
                </div>
                <p id="network-summary">–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞...</p>
            </div>

            <div class="card">
                <h3>üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API</h3>
                <div class="api-section">
                    <button class="api-button" onclick="testStore()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</button>
                    <button class="api-button" onclick="testFind()">–ù–∞–π—Ç–∏ –¥–∞–Ω–Ω—ã–µ</button>
                    <button class="api-button" onclick="testStats()">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
                    <div class="response-area" id="api-response">–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è API</div>
                </div>
            </div>

            <div class="card">
                <h3>üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–µ—Ç–∏</h3>
                <div id="network-stats">
                    <p>üìä –í—Å–µ–≥–æ —É–∑–ª–æ–≤: <span id="total-nodes">6</span></p>
                    <p>‚úÖ –û–Ω–ª–∞–π–Ω: <span id="online-nodes">0</span></p>
                    <p>‚ùå –û—Ñ–ª–∞–π–Ω: <span id="offline-nodes">6</span></p>
                    <p>üîÑ –ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: <span id="last-update">-</span></p>
                </div>
            </div>

            <div class="card">
                <h3>üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç</h3>
                <div style="font-family: monospace; background: rgba(0,0,0,0.3); padding: 15px; border-radius: 8px;">
                    <p># –ó–∞–ø—É—Å–∫ DHT —Å–µ—Ç–∏:</p>
                    <p>./dht-network.sh start</p>
                    <br>
                    <p># –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:</p>
                    <p>./dht-network.sh test</p>
                    <br>
                    <p># –°—Ç–∞—Ç—É—Å:</p>
                    <p>./dht-network.sh status</p>
                </div>
            </div>
        </div>

        <div class="links-section">
            <h3>üîó –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏</h3>
            <a href="http://localhost:9090" class="link-button" target="_blank">üìä Prometheus</a>
            <a href="http://localhost:3001" class="link-button" target="_blank">üìà Grafana</a>
            <a href="http://localhost:8080/api/docs" class="link-button" target="_blank">üìö API Docs</a>
            <a href="https://github.com/kirilldogadin/dht" class="link-button" target="_blank">üíª GitHub</a>
        </div>
    </div>

    <script>
        const nodes = [8080, 8081, 8082, 8083, 8084, 8085];
        let onlineCount = 0;

        async function checkNodeStatus(port) {
            try {
                const response = await fetch(`http://localhost:${port}/api/health`, {
                    method: 'GET',
                    timeout: 5000
                });
                return response.ok;
            } catch (error) {
                return false;
            }
        }

        async function updateNodeStatuses() {
            onlineCount = 0;
            
            for (const port of nodes) {
                const isOnline = await checkNodeStatus(port);
                const indicator = document.getElementById(`status-${port}`);
                
                if (isOnline) {
                    indicator.className = 'status-indicator online';
                    onlineCount++;
                } else {
                    indicator.className = 'status-indicator offline';
                }
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            document.getElementById('online-nodes').textContent = onlineCount;
            document.getElementById('offline-nodes').textContent = nodes.length - onlineCount;
            document.getElementById('last-update').textContent = new Date().toLocaleTimeString();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–≤–æ–¥–∫—É
            const summary = document.getElementById('network-summary');
            if (onlineCount === nodes.length) {
                summary.textContent = 'üéâ –í—Å—è —Å–µ—Ç—å —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Ç–ª–∏—á–Ω–æ!';
                summary.style.color = '#10b981';
            } else if (onlineCount >= 3) {
                summary.textContent = '‚ö†Ô∏è –°–µ—Ç—å —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏';
                summary.style.color = '#f59e0b';
            } else if (onlineCount > 0) {
                summary.textContent = '‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–µ—Ç–∏';
                summary.style.color = '#ef4444';
            } else {
                summary.textContent = 'üî¥ –°–µ—Ç—å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞';
                summary.style.color = '#ef4444';
            }
        }

        async function testStore() {
            const responseArea = document.getElementById('api-response');
            responseArea.textContent = '–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö...';
            
            try {
                const response = await fetch('http://localhost:8080/api/store/test-key', {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        value: 'Hello DHT!',
                        timestamp: new Date().toISOString()
                    })
                });
                
                const result = await response.text();
                responseArea.textContent = `‚úÖ –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã:\n${result}`;
            } catch (error) {
                responseArea.textContent = `‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:\n${error.message}`;
            }
        }

        async function testFind() {
            const responseArea = document.getElementById('api-response');
            responseArea.textContent = '–ü–æ–∏—Å–∫ –¥–∞–Ω–Ω—ã—Ö...';
            
            try {
                const response = await fetch('http://localhost:8081/api/find/test-key');
                const result = await response.text();
                responseArea.textContent = `üîç –†–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ–∏—Å–∫–∞:\n${result}`;
            } catch (error) {
                responseArea.textContent = `‚ùå –û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞:\n${error.message}`;
            }
        }

        async function testStats() {
            const responseArea = document.getElementById('api-response');
            responseArea.textContent = '–ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏...';
            
            try {
                const response = await fetch('http://localhost:8080/api/stats');
                const result = await response.text();
                responseArea.textContent = `üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —É–∑–ª–∞:\n${result}`;
            } catch (error) {
                responseArea.textContent = `‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:\n${error.message}`;
            }
        }

        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
        updateNodeStatuses();
        setInterval(updateNodeStatuses, 5000);
    </script>
</body>
</html>

