# Отчет о выполнении задач первого спринта DHT

## Общая информация

**Проект**: Распределенная хеш-таблица (DHT) на основе алгоритма Kademlia
**Спринт**: 1 - Базовые компоненты
**Статус**: Завершен

## Реализованные задачи

### 1. XOR метрика

#### Задача 1: Реализация метода `computeDistanceAsUnionId`
- Реализован метод вычисления XOR-расстояния между двумя идентификаторами
- Результат возвращается как новый объект `KademliaId`
- Добавлены вспомогательные методы для работы с байтовыми массивами

#### Задача 2: Добавление метода сравнения идентификаторов
- Реализован метод `compareTo` для лексикографического сравнения идентификаторов
- Метод возвращает отрицательное число, если текущий ID меньше другого
- Метод возвращает положительное число, если текущий ID больше другого
- Метод возвращает 0, если идентификаторы равны

#### Задача 3: Реализация метода для определения общего префикса
- Реализован метод `getCommonPrefixLength` для вычисления длины общего префикса
- Метод оптимизирован для быстрого определения совпадающих бит
- Используется для оптимизации маршрутизации в Kademlia

#### Задача 4: Тесты для XOR метрики
- Созданы тесты для проверки создания идентификаторов
- Добавлены тесты для проверки вычисления расстояния
- Реализованы тесты для методов сравнения и определения общего префикса
- Добавлены тесты для проверки методов equals и hashCode

### 2. K-buckets с LRU логикой

#### Задача 1: Реализация LRU логики в методе `checkCapacity`
- Заменен `HashSet` на `ArrayList` для поддержки упорядоченного списка узлов
- Реализован метод `checkCapacity`, удаляющий наименее недавно использованный узел
- Добавлена потокобезопасность с использованием `ReadWriteLock`
- Реализована полная LRU логика для добавления, обновления и удаления узлов

#### Задача 2: Механизм обновления узлов при получении сообщений
- Добавлено отслеживание времени последней активности узла
- Реализовано обновление статуса узла при получении сообщений
- Добавлены методы для управления статусом активности узла
- Реализовано перемещение обновленных узлов в конец списка (как недавно использованных)

#### Задача 3: Механизм пинга неактивных узлов
- Реализован планировщик для периодической проверки неактивных узлов
- Добавлен колбэк для выполнения пинга узлов
- Реализован механизм отслеживания неудачных попыток связи
- Добавлено автоматическое удаление узлов, не отвечающих на пинги

#### Задача 4: Логика разделения переполненных k-buckets
- Реализован механизм разделения бакета на два дочерних
- Добавлена поддержка префиксов для определения принадлежности узла к бакету
- Реализована древовидная структура бакетов
- Добавлена логика перераспределения узлов при разделении бакета

#### Задача 5: Тесты для k-buckets
- Созданы тесты для проверки добавления и обновления узлов
- Добавлены тесты для проверки LRU логики
- Реализованы тесты для механизма пинга неактивных узлов
- Добавлены тесты для проверки разделения бакетов
- Реализованы тесты для проверки потокобезопасности

## Pull Requests

### PR для XOR метрики
- **Ветка**: `feature/xor-metric`
- **URL**: https://github.com/kirilldogadin/dht/pull/new/feature/xor-metric
- **Описание**: Реализация XOR метрики для DHT, включая методы сравнения идентификаторов и определения общего префикса

### PR для K-buckets
- **Ветка**: `feature/k-buckets`
- **URL**: https://github.com/kirilldogadin/dht/pull/new/feature/k-buckets
- **Описание**: Реализация K-buckets с LRU логикой, механизмами обновления узлов, пинга неактивных узлов и разделения переполненных бакетов

## Документация

Для обоих компонентов созданы README файлы с описанием функциональности и примерами использования:

- [README для XOR метрики](https://github.com/kirilldogadin/dht/blob/feature/xor-metric/src/main/java/global/unet/domain/id/README.md)
- [README для K-buckets](https://github.com/kirilldogadin/dht/blob/feature/k-buckets/src/main/java/global/unet/domain/structures/README.md)

## Заключение

Все задачи первого спринта успешно выполнены. Реализованы базовые компоненты DHT: XOR метрика и K-buckets с LRU логикой. Код покрыт тестами и готов к использованию в следующих спринтах.

